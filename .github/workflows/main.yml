- name: Start Stream (Final Fixed Logic)
      env:
        S_KEY: ${{ secrets.YOUTUBE_STREAM_KEY }}
      run: |
        DURATION_SEC=$(( ${{ github.event.inputs.stream_duration }} * 3600 ))
        
        ffmpeg -re -loop 1 -framerate 25 -i "pro dashboard v3.0.png" \
               -re -stream_loop -1 -i "videos/video1.mp4" \
               -re -stream_loop -1 -i "videos/video2.mp4" \
               -re -stream_loop -1 -i "videos/video3.mp4" \
               -re -stream_loop -1 -i "videos/video4.mp4" \
               -re -stream_loop -1 -i "videos/video5.mp4" \
               -f lavfi -re -i anullsrc=channel_layout=stereo:sample_rate=44100 \
               -filter_complex " \
                [0:v]scale=2560:1440[bg]; \
                [1:v]scale=1280:720:force_original_aspect_ratio=increase,crop=1280:720[v1]; \
                [2:v]scale=1280:720:force_original_aspect_ratio=increase,crop=1280:720[v2]; \
                [3:v]scale=1015:720:force_original_aspect_ratio=increase,crop=1015:720[v3]; \
                [4:v]scale=1025:720:force_original_aspect_ratio=increase,crop=1025:720[v4]; \
                [5:v]scale=520:720:force_original_aspect_ratio=increase,crop=520:720[v5]; \
                [bg][v1]overlay=x=0:y=0[b1]; \
                [b1][v2]overlay=x=1280:y=0[b2]; \
                [b2][v3]overlay=x=0:y=720[b3]; \
                [b3][v4]overlay=x=1015:y=720[b4]; \
                [b4][v5]overlay=x=2040:y=720[b5]; \
                [b5]drawtext=text='${{ github.event.inputs.bottom_text }}':fontfile=/usr/share/fonts/truetype/dejavu/DejaVuSans-Bold.ttf:fontcolor=white:fontsize=70:y=h-100:x=w-mod(t*180\,w+tw)[v_out]; \
                [1:a]volume=0.1[a1]; \
                [2:a]volume=0.1[a2]; \
                [5:a]volume=1.0[a5]; \
                [6:a]volume=0.01[asilent]; \
                [a1][a2][a5][asilent]amix=inputs=4:duration=longest[a_out]" \
               -map "[v_out]" \
               -map "[a_out]" \
               -c:v libx264 -preset ultrafast -tune zerolatency -threads 4 \
               -b:v 8000k -maxrate 8000k -bufsize 16000k \
               -pix_fmt yuv420p -g 50 \
               -c:a aac -b:a 128k -ar 44100 \
               -f flv -t $DURATION_SEC \
               "rtmp://a.rtmp.youtube.com/live2/$S_KEY"
